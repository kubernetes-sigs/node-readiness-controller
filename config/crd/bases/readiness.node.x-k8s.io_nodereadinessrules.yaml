---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.19.0
  name: nodereadinessrules.readiness.node.x-k8s.io
spec:
  group: readiness.node.x-k8s.io
  names:
    kind: NodeReadinessRule
    listKind: NodeReadinessRuleList
    plural: nodereadinessrules
    shortNames:
    - nrr
    singular: nodereadinessrule
  scope: Cluster
  versions:
  - additionalPrinterColumns:
    - description: Continuous, Bootstrap or Dryrun - shows if the rule is in enforcement
        or dryrun mode.
      jsonPath: .spec.enforcementMode
      name: Mode
      type: string
    - description: The readiness taint applied by this rule.
      jsonPath: .spec.taint.key
      name: Taint
      type: string
    - description: The age of this resource
      jsonPath: .metadata.creationTimestamp
      name: Age
      type: date
    name: v1alpha1
    schema:
      openAPIV3Schema:
        description: NodeReadinessRule is the Schema for the NodeReadinessRules API.
        properties:
          apiVersion:
            description: |-
              APIVersion defines the versioned schema of this representation of an object.
              Servers should convert recognized schemas to the latest internal value, and
              may reject unrecognized values.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources
            type: string
          kind:
            description: |-
              Kind is a string value representing the REST resource this object represents.
              Servers may infer this from the endpoint the client submits requests to.
              Cannot be updated.
              In CamelCase.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds
            type: string
          metadata:
            type: object
          spec:
            description: spec defines the desired state of NodeReadinessRule
            properties:
              conditions:
                description: |-
                  conditions contains a list of the Node conditions that defines the specific
                  criteria that must be met for taints to be managed on the target Node.
                  The presence or status of these conditions directly triggers the application or removal of Node taints.
                items:
                  description: |-
                    ConditionRequirement defines a specific Node condition and the status value
                    required to trigger the controller's action.
                  properties:
                    requiredStatus:
                      description: requiredStatus is status of the condition, one
                        of True, False, Unknown.
                      enum:
                      - "True"
                      - "False"
                      - Unknown
                      type: string
                    type:
                      description: |-
                        type of Node condition

                        Following kubebuilder validation is referred from https://pkg.go.dev/k8s.io/apimachinery/pkg/apis/meta/v1#Condition
                      maxLength: 316
                      minLength: 1
                      type: string
                  required:
                  - requiredStatus
                  - type
                  type: object
                maxItems: 32
                minItems: 1
                type: array
                x-kubernetes-list-map-keys:
                - type
                x-kubernetes-list-type: map
              dryRun:
                description: |-
                  dryRun when set to true, The controller will evaluate Node conditions and log intended taint modifications
                  without persisting changes to the cluster. Proposed actions are reflected in the resource status.
                type: boolean
              enforcementMode:
                description: |-
                  enforcementMode specifies how the controller maintains the desired state.
                  enforcementMode is one of bootstrap-only, continuous.
                  "bootstrap-only" applies the configuration once during initial setup.
                  "continuous" ensures the state is monitored and corrected throughout the resource lifecycle.
                enum:
                - bootstrap-only
                - continuous
                type: string
              nodeSelector:
                description: nodeSelector limits the scope of this rule to a specific
                  subset of Nodes.
                properties:
                  matchExpressions:
                    description: matchExpressions is a list of label selector requirements.
                      The requirements are ANDed.
                    items:
                      description: |-
                        A label selector requirement is a selector that contains values, a key, and an operator that
                        relates the key and values.
                      properties:
                        key:
                          description: key is the label key that the selector applies
                            to.
                          type: string
                        operator:
                          description: |-
                            operator represents a key's relationship to a set of values.
                            Valid operators are In, NotIn, Exists and DoesNotExist.
                          type: string
                        values:
                          description: |-
                            values is an array of string values. If the operator is In or NotIn,
                            the values array must be non-empty. If the operator is Exists or DoesNotExist,
                            the values array must be empty. This array is replaced during a strategic
                            merge patch.
                          items:
                            type: string
                          type: array
                          x-kubernetes-list-type: atomic
                      required:
                      - key
                      - operator
                      type: object
                    type: array
                    x-kubernetes-list-type: atomic
                  matchLabels:
                    additionalProperties:
                      type: string
                    description: |-
                      matchLabels is a map of {key,value} pairs. A single {key,value} in the matchLabels
                      map is equivalent to an element of matchExpressions, whose key field is "key", the
                      operator is "In", and the values array contains only "value". The requirements are ANDed.
                    type: object
                type: object
                x-kubernetes-map-type: atomic
              taint:
                description: |-
                  taint defines the specific Taint (Key, Value, and Effect) to be managed
                  on Nodes that meet the defined condition criteria.

                  Supported effects: NoSchedule, PreferNoSchedule, NoExecute.
                  Caution: NoExecute evicts existing pods and can cause significant disruption
                  when combined with continuous enforcement mode. Prefer NoSchedule for most use cases.
                properties:
                  effect:
                    description: |-
                      Required. The effect of the taint on pods
                      that do not tolerate the taint.
                      Valid effects are NoSchedule, PreferNoSchedule and NoExecute.
                    type: string
                  key:
                    description: Required. The taint key to be applied to a node.
                    type: string
                  timeAdded:
                    description: TimeAdded represents the time at which the taint
                      was added.
                    format: date-time
                    type: string
                  value:
                    description: The taint value corresponding to the taint key.
                    type: string
                required:
                - effect
                - key
                type: object
                x-kubernetes-validations:
                - message: taint key must start with 'readiness.k8s.io/'
                  rule: self.key.startsWith('readiness.k8s.io/')
                - message: taint key length must be at most 253 characters
                  rule: self.key.size() <= 253
                - message: taint value length must be at most 63 characters
                  rule: '!has(self.value) || self.value.size() <= 63'
                - message: taint effect must be one of 'NoSchedule', 'PreferNoSchedule',
                    'NoExecute'
                  rule: self.effect in ['NoSchedule', 'PreferNoSchedule', 'NoExecute']
            required:
            - conditions
            - enforcementMode
            - nodeSelector
            - taint
            type: object
          status:
            description: status defines the observed state of NodeReadinessRule
            minProperties: 1
            properties:
              dryRunResults:
                description: |-
                  dryRunResults captures the outcome of the rule evaluation when DryRun is enabled.
                  This field provides visibility into the actions the controller would have taken,
                  allowing users to preview taint changes before they are committed.
                minProperties: 1
                properties:
                  affectedNodes:
                    description: affectedNodes is the total count of Nodes that match
                      the rule's criteria.
                    format: int32
                    minimum: 0
                    type: integer
                  riskyOperations:
                    description: |-
                      riskyOperations represents the count of Nodes where required conditions
                      are missing entirely, potentially indicating an ambiguous node state.
                    format: int32
                    minimum: 0
                    type: integer
                  summary:
                    description: |-
                      summary provides a human-readable overview of the dry run evaluation,
                      highlighting key findings or warnings.
                    maxLength: 4096
                    minLength: 1
                    type: string
                  taintsToAdd:
                    description: taintsToAdd is the number of Nodes that currently
                      lack the specified taint and would have it applied.
                    format: int32
                    minimum: 0
                    type: integer
                  taintsToRemove:
                    description: |-
                      taintsToRemove is the number of Nodes that currently possess the
                      taint but no longer meet the criteria, leading to its removal.
                    format: int32
                    minimum: 0
                    type: integer
                required:
                - summary
                type: object
              lastEvaluationTime:
                description: lastEvaluationTime is the timestamp when the rule was
                  evaluated against all the nodes in the cluster.
                format: date-time
                type: string
              observedGeneration:
                description: observedGeneration reflects the generation of the most
                  recently observed NodeReadinessRule by the controller.
                format: int64
                minimum: 1
                type: integer
            required:
            - lastEvaluationTime
            type: object
        required:
        - spec
        type: object
    served: true
    storage: true
    subresources:
      status: {}
